# Standards: 1.1.38
---

# 1.5.4 Ensure prelink is disabled

- name: 1.5.4 - Check if prelink is installed
  shell: "dpkg -l | grep prelink | cut -d' ' -f1"  
  register: pkg
  tags:
    - level-1
    - "1.5.4"
    - scored
    - skip_ansible_lint

- name: 1.5.4 - Display the registered package
  debug:
    msg: Value equals {{ pkg.stdout_lines }} 
  when: pkg.stdout_lines != "ii"
  tags:
    - level-1
    - "1.5.4"
    - scored
    - skip_ansible_lint

- name: 1.5.4 - Restore prelinked binaries
  command: prelink -ua
#  when: which_1_5_4.rc is defined and which_1_5_4.rc == 0
#  when: which_1_5_4.results.yumstate == 'installed'
#  when: which_1_5_4.results | search("installed")
  when: pkg.stdout_lines != "ii"
  tags:
    - level-1
    - "1.5.4"
    - scored
    - skip_ansible_lint

- name: 1.5.4 - Ensure prelink is disabled
  apt:
    name: prelink
    state: absent
  when: pkg.stdout_lines != "ii"
  tags:
    - level-1
    - "1.5.4"
    - scored
